<script>
  $(function() {
    $( "#bookmark_adding_dialog" ).dialog({ autoOpen: false, width: 430 });
  });
</script>

<table class="toolbar">
  <tr>
    <td style="width: 260px;">
      <fieldset class="tool">
        <legend>เลือกอ่านที่</legend> 
          <div style="float:left;padding-left:3px;">
            <%= render 'goto_page_form' %>
          </div>
          <div style="float:right;padding-right:3px;">
            <%= render 'goto_item_form' %>
          </div>
      </fieldset>
    </td>
    <td style="width: 100px;">
      <fieldset class="tool">
        <legend>อ่านทีละหน้า</legend> 
        <div class="back_button">
          <%= link_to image_tag('left.png', 
                                :alt => '<<', 
                                :size => "32x32"), 
                      :action => 'read', 
                      :volume => @volume,
                      :number => @number.to_i-1,
                      :keywords => @keywords,
                      :language => @language if @number.to_i > 1 %>
        </div>
        <div class="next_button">
          <%= link_to image_tag('right.png', 
                                :alt => '>>',
                                :size => "32x32"), 
              :action => 'read', 
              :volume => @volume,
              :number => @number.to_i+1,
              :keywords => @keywords,
              :language => @language if !@max_number.nil? and @number.to_i < @max_number %>
        </div>
      </fieldset>
    </td>
    <% if @number.to_i != 0 %>
    <td style="width:200px;">
      <fieldset class="tool">
        <legend>เทียบเคียงกับ</legend> 
        <div class="compare_form">
          <%= render :partial => 'compare_form', :locals => { :lang1 => @language,
                                                  :volume => @volume,
                                                  :p1 => @number } %>
        </div>
      </fieldset>
    </td>
    <% end %>
    <% if signed_in? %>
    <td style="width:130px;">
      <fieldset class="tool">
        <legend>รายการจดจำ</legend>
        <div class="bookmark">
          <%= link_to 'เรียกดู', bookmarks_path %>
          <%= link_to 'เพิ่ม' , '#', 
                :onclick => 'return $("#bookmark_adding_dialog").dialog("open");' if @number.to_i > 0 %>
        </div>
      </fieldset>
    </td>
    <% end %>
    <td>&nbsp;</td>
  </tr>
</table>

<% if signed_in? and @number.to_i > 0 %>
<div id="bookmark_adding_dialog" title="เพิ่มรายการจดจำ">
  <div style="text-align:center">
    <%= readable_language(@language) %>
  </div>
  <%= form_for @bookmark do |f| %>
    <div style="text-align:center">
      <span>เล่มที่</span> <span><%= i_to_thai @volume %></span> 
      <span>หน้าที่</span> <span><%= i_to_thai @number %></span>
      <span>ข้อที่</span>
      <span>
        <% page = Page.find_by_language_and_volume_and_number(@language,@volume,@number) 
           items = page.items.map { |item| item.number } 
           items = items.uniq.map { |item| [i_to_thai(item), item] }
        %>
        <%= f.select :item_number, items %>
      </span>
      <%= f.hidden_field :refer, :name => :refer, :value => request.request_uri.to_s %>
      <%= f.hidden_field :page_id, :value => page.id %>
    </div>
    <div class="field">
      <%= f.text_area :note %>
    </div>
    <div class="actions">
      <%= f.submit "เพิ่ม" %>
    </div>
  <% end %>
</div>
<% end %>

